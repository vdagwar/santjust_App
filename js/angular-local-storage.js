!function (e, t) { var o = t.isDefined, r = t.isUndefined, n = t.isNumber, i = t.isObject, a = t.isArray, s = t.isString, c = t.extend, u = t.toJson; t.module("LocalStorageModule", []).provider("localStorageService", function () { this.prefix = "ls", this.storageType = "localStorage", this.cookie = { expiry: 30, path: "/", secure: !1 }, this.defaultToCookie = !0, this.notify = { setItem: !0, removeItem: !1 }, this.setPrefix = function (e) { return this.prefix = e, this }, this.setStorageType = function (e) { return this.storageType = e, this }, this.setDefaultToCookie = function (e) { return this.defaultToCookie = !!e, this }, this.setStorageCookie = function (e, t, o) { return this.cookie.expiry = e, this.cookie.path = t, this.cookie.secure = o, this }, this.setStorageCookieDomain = function (e) { return this.cookie.domain = e, this }, this.setNotify = function (e, t) { return this.notify = { setItem: e, removeItem: t }, this }, this.$get = ["$rootScope", "$window", "$document", "$parse", "$timeout", function (e, t, l, g, f) { function d(o) { if (o || (o = t.event), S.setItem && s(o.key) && O(o.key)) { var r = k(o.key); f(function () { e.$broadcast("LocalStorageModule.notification.changed", { key: r, newvalue: o.newValue, storageType: m.storageType }) }) } } var h, m = this, T = m.prefix, p = m.cookie, S = m.notify, y = m.storageType; l ? l[0] && (l = l[0]) : l = document, "." !== T.substr(-1) && (T = T ? T + "." : ""); var v = function (e) { return T + e }, k = function (e) { return e.replace(new RegExp("^" + T, "g"), "") }, O = function (e) { return 0 === e.indexOf(T) }, b = function () { try { var o = y in t && null !== t[y], r = v("__" + Math.round(1e7 * Math.random())); return o && (h = t[y], h.setItem(r, ""), h.removeItem(r)), o } catch (n) { return m.defaultToCookie && (y = "cookie"), e.$broadcast("LocalStorageModule.notification.error", n.message), !1 } }, L = b(), $ = function (t, o, n) { if (D(n), o = r(o) ? null : u(o), !L && m.defaultToCookie || "cookie" === m.storageType) return L || e.$broadcast("LocalStorageModule.notification.warning", "LOCAL_STORAGE_NOT_SUPPORTED"), S.setItem && e.$broadcast("LocalStorageModule.notification.setitem", { key: t, newvalue: o, storageType: "cookie" }), _(t, o); try { h && h.setItem(v(t), o), S.setItem && e.$broadcast("LocalStorageModule.notification.setitem", { key: t, newvalue: o, storageType: m.storageType }) } catch (i) { return e.$broadcast("LocalStorageModule.notification.error", i.message), _(t, o) } return !0 }, E = function (t, o) { if (D(o), !L && m.defaultToCookie || "cookie" === m.storageType) return L || e.$broadcast("LocalStorageModule.notification.warning", "LOCAL_STORAGE_NOT_SUPPORTED"), R(t); var r = h ? h.getItem(v(t)) : null; if (!r || "null" === r) return null; try { return JSON.parse(r) } catch (n) { return r } }, M = function () { var t = 0; arguments.length >= 1 && ("localStorage" === arguments[arguments.length - 1] || "sessionStorage" === arguments[arguments.length - 1]) && (t = 1, D(arguments[arguments.length - 1])); var o, r; for (o = 0; o < arguments.length - t; o++) if (r = arguments[o], !L && m.defaultToCookie || "cookie" === m.storageType) L || e.$broadcast("LocalStorageModule.notification.warning", "LOCAL_STORAGE_NOT_SUPPORTED"), S.removeItem && e.$broadcast("LocalStorageModule.notification.removeitem", { key: r, storageType: "cookie" }), I(r); else try { h.removeItem(v(r)), S.removeItem && e.$broadcast("LocalStorageModule.notification.removeitem", { key: r, storageType: m.storageType }) } catch (n) { e.$broadcast("LocalStorageModule.notification.error", n.message), I(r) } }, w = function (t) { if (D(t), !L) return e.$broadcast("LocalStorageModule.notification.warning", "LOCAL_STORAGE_NOT_SUPPORTED"), []; var o = T.length, r = []; for (var n in h) if (n.substr(0, o) === T) try { r.push(n.substr(o)) } catch (i) { return e.$broadcast("LocalStorageModule.notification.error", i.Description), [] } return r }, x = function (t, o) { D(o); var r = T ? new RegExp("^" + T) : new RegExp, n = t ? new RegExp(t) : new RegExp; if (!L && m.defaultToCookie || "cookie" === m.storageType) return L || e.$broadcast("LocalStorageModule.notification.warning", "LOCAL_STORAGE_NOT_SUPPORTED"), A(); if (!L && !m.defaultToCookie) return !1; var i = T.length; for (var a in h) if (r.test(a) && n.test(a.substr(i))) try { M(a.substr(i)) } catch (s) { return e.$broadcast("LocalStorageModule.notification.error", s.message), A() } return !0 }, C = function () { try { return t.navigator.cookieEnabled || "cookie" in l && (l.cookie.length > 0 || (l.cookie = "test").indexOf.call(l.cookie, "test") > -1) } catch (o) { return e.$broadcast("LocalStorageModule.notification.error", o.message), !1 } }(), _ = function (t, o, s, c) { if (r(o)) return !1; if ((a(o) || i(o)) && (o = u(o)), !C) return e.$broadcast("LocalStorageModule.notification.error", "COOKIES_NOT_SUPPORTED"), !1; try { var g = "", f = new Date, d = ""; if (null === o ? (f.setTime(f.getTime() + -864e5), g = "; expires=" + f.toGMTString(), o = "") : n(s) && 0 !== s ? (f.setTime(f.getTime() + 24 * s * 60 * 60 * 1e3), g = "; expires=" + f.toGMTString()) : 0 !== p.expiry && (f.setTime(f.getTime() + 24 * p.expiry * 60 * 60 * 1e3), g = "; expires=" + f.toGMTString()), t) { var h = "; path=" + p.path; p.domain && (d = "; domain=" + p.domain), "boolean" == typeof c ? c === !0 && (d += "; secure") : p.secure === !0 && (d += "; secure"), l.cookie = v(t) + "=" + encodeURIComponent(o) + g + h + d } } catch (m) { return e.$broadcast("LocalStorageModule.notification.error", m.message), !1 } return !0 }, R = function (t) { if (!C) return e.$broadcast("LocalStorageModule.notification.error", "COOKIES_NOT_SUPPORTED"), !1; for (var o = l.cookie && l.cookie.split(";") || [], r = 0; r < o.length; r++) { for (var n = o[r]; " " === n.charAt(0) ;) n = n.substring(1, n.length); if (0 === n.indexOf(v(t) + "=")) { var i = decodeURIComponent(n.substring(T.length + t.length + 1, n.length)); try { var a = JSON.parse(i); return "number" == typeof a ? i : a } catch (s) { return i } } } return null }, I = function (e) { _(e, null) }, A = function () { for (var e = null, t = T.length, o = l.cookie.split(";"), r = 0; r < o.length; r++) { for (e = o[r]; " " === e.charAt(0) ;) e = e.substring(1, e.length); var n = e.substring(t, e.indexOf("=")); I(n) } }, P = function () { return y }, D = function (e) { return e && y !== e && (y = e, L = b()), L }, N = function (e, t, r, n, a) { n = n || t; var s = E(n, a); return null === s && o(r) ? s = r : i(s) && i(r) && (s = c(s, r)), g(t).assign(e, s), e.$watch(t, function (e) { $(n, e, a) }, i(e[t])) }; L && (t.addEventListener ? (t.addEventListener("storage", d, !1), e.$on("$destroy", function () { t.removeEventListener("storage", d) })) : t.attachEvent && (t.attachEvent("onstorage", d), e.$on("$destroy", function () { t.detachEvent("onstorage", d) }))); var U = function (e) { D(e); for (var o = 0, r = t[y], n = 0; n < r.length; n++) 0 === r.key(n).indexOf(T) && o++; return o }; return { isSupported: L, getStorageType: P, setStorageType: D, set: $, add: $, get: E, keys: w, remove: M, clearAll: x, bind: N, deriveKey: v, underiveKey: k, length: U, defaultToCookie: this.defaultToCookie, cookie: { isSupported: C, set: _, add: _, get: R, remove: I, clearAll: A } } }] }) }(window, window.angular);